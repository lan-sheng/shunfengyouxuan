<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns=http://www.w3.org/1999/xhtml><meta charset=utf-8><meta http-equiv=Cache-Control content=no-transform><meta http-equiv=Cache-Control content=no-siteapp><title>商品详情页</title><meta name=Keywords content="恒都 新西兰切块羊后腿肉500g,恒都,肉类,羊肉,进口羊肉,顺丰优选"><meta name=Description content="顺丰优选(sfbest.com)提供恒都进口羊肉，恒都 新西兰切块羊后腿肉500g价格最低，包括恒都 新西兰切块羊后腿肉500g食用指南、健康知识以及恒都 新西兰切块羊后腿肉500g图片、品牌、价格、行情、评价、饮食文化等信息。选购恒都进口羊肉上顺丰优选，优选美食，顺丰到家！"><link rel=stylesheet type=text/css href=./css/detail_0.css><link rel=stylesheet type=text/css href=./css/detail_1.css><link rel=stylesheet type=text/css href=./css/detail_2.css><link rel=stylesheet type=text/css href=./css/detail_3.css><link type=image/x-icon rel="shortcut icon" href=./img/detail/images/48.ico><style>
    #sf {
        width: 50px;
        height: 50px;
        background: orange;
        opacity: 0.3;
        position: absolute;
        left: 0px;
        top: 0px;
        visibility: hidden;
    }
    
    #bf {
        width: 400px;
        height: 400px;
        border: 1px solid #000;
        overflow: hidden;
        position: absolute;
        left: 410px;
        visibility: hidden;
        z-index: 100;
    }
    
    #bf img {
        position: absolute;
        left: 0px;
        top: 0px;
        width: 800px;
        height: 800px;
    }
</style><body><div class="gg_full wrapfix" style=display:none><div class=gg_fcon></div></div><link href=./css/detail_4.css type=text/css rel=stylesheet><div id=screen></div><div class=indexshadow id=shadowAllCity></div><div class=pWrap><div class=productIntro><div class=pItems><div class=pItemsMain><div class=pItemsName><div class=cm><div class=owner_shop>自营</div><h1 id=base_name-sf>恒都 新西兰切块羊后腿肉500g</h1><strong id=adword-sf>&nbsp;&nbsp;</strong></div></div><div class=pItemsPrice id=price-sf><div class=priceBox><span class=dt>优选价：</span><span class=rmb>￥</span><strong class=price>69</strong></div><div class=daoJiShi id=qianggou-sf></div><a class=p_btn href=#>开通优选会员</a><div class=boxWb></div></div><div class=clear></div><div id=presell-info-sf class=sf-presell style=display:none></div><div class=pItemsPromo id=promotion-sf style=display:none></div><div class=pItemsStock><div class=dt>送至：</div><div class=dd><div id=regionSf><div id=store-selector><div class=text><div class=address-more title=浙江省杭州市西湖区>浙江省杭州市西湖区</div><b></b></div></div></div><div class=pItemsPrompt></div></div><span class=clear></span></div><div class=pItemsSend id=time-sf></div><div class=pItemsChoose><div class=chooseType><ul id=fatherson-sf></ul><span class=clear></span></div><div class=chooseBtns id=buy-btn-sf style="z-index: 1;"><div class=pAmount><span><input type=text id=number class=text></span> <span><a href=javascript:; id=add-sell-num class=p-add>+</a> <a href=javascript:; id=reduce-sell-num class="p-reduce disable">-</a></span></div><div class=pBtn id=cart-add-btn-sf><a><b></b>加入购物车</a></div><div class="pBtn quickBuy" id=quickBuy title=快速下单，直达填写订单页面><a onclick="oneKeyBuy(302885, 0, 1, 0, 1, this);">一键购买</a></div><div class="phone_client phone_border" style="cursor: pointer;"><div id=phone_time>扫描下载客户端<br><em></em></div></div><span class=clear></span></div><div class=finalBuy id=finalbuy-sf style=display:none></div></div></div><div class=pView><div id=pView><div id=zoom-jpg class=jqzoom><img width=330 height=330><div id=sf></div></div><div id=bf><img id=bpic></div><div id=pic-list><a href=javascript:void(0); class="btn-control disabled" id=btn-forward><b></b></a> <a href=javascript:void(0); class=btn-control id=btn-backward><b></b></a><div class=pic-items style="position: absolute; width: 50px; height: 300px; overflow: hidden;"><ul style="position: absolute; left: 0px; top: 0px; height: 600px;"></ul></div></div></div><div class=pShare><div class=bdShare><div id=bdshare class="bdshare_t bds_tools get-codes-bdshare"><span class=bds_more>分享到：</span> <a class=bds_qzone title=分享到QQ空间 href=#></a> <a class=bds_tsina title=分享到新浪微博 href=#></a></div><span class=clear></span><script type=text/javascript id=bdshare_js data="type=tools&amp;uid=6427643" src="http://bdimg.share.baidu.com/static/js/bds_s_v2.js?cdnversion=437966"></script></div><div class=pCollect><a href=javascript:void(0); id=goodsAddFav onclick=Goods.addFav(this);>收藏商品</a></div><span class=clear></span></div></div></div><span class=clear></span></div></div><div class=clear1></div><style>
        .backToTop {
            width: 0;
            height: 0;
            background: 0 none;
            border-bottom: 0 none;
            overflow: hidden;
            line-height: 0;
            font-size: 0
        }
    </style><script src=./script/detail/ajaxpromise.js></script><script src=./script/detail/move.js></script><script src=./script/detail/cookie.js></script><script>
        ! function() {
            class Detail {
                constructor() {
                        this.sid = location.search.substring(1).split('=')[1]; //获取url?后面的sid的值
                        this.spicimg = document.querySelector('.jqzoom img'); //小图里面的图片
                        this.spic = document.querySelector('.jqzoom'); //小图上面的div
                        this.sf = document.querySelector('#sf'); //小放大镜
                        this.bf = document.querySelector('#bf'); //大放大镜
                        this.bpic = document.querySelector('#bpic'); //大放大镜下大图
                        this.loadtitle = document.querySelector('#base_name-sf'); //标题
                        this.loadpcp = document.querySelector('.price'); //价格
                        this.list = document.querySelector('.pic-items ul'); //用于切换的小小图
                        this.goodsinfo = document.querySelector('.pWrap'); //body下整个div
                        this.left = document.querySelector('#btn-forward'); //左按钮
                        this.right = document.querySelector('#btn-backward'); //右边按钮
                        this.btn = document.querySelector('.pBtn'); //加入购物车
                        this.count = document.querySelector('#number'); //加入购物车数量
                    }
                    //传递sid
                init() {
                        let _this = this;
                        //将当前获取的sid传给后端，返回对应的数据
                        ajax({
                            url: 'http://10.31.161.225/shunfengyouxuan/php/detail.php',
                            data: {
                                picsid: this.sid
                            },
                            dataType: 'json'
                        }).then(function(data) {
                            //获取对应的数据，渲染。

                            _this.render(data)
                        });
                        //放大镜效果
                        this.scale();

                        //购物车效果
                        this.goodscart();
                    }
                    //获取接口进行渲染。
                render(data) {
                        this.spicimg.src = data.url; //小放大镜下图片
                        this.loadtitle.innerHTML = data.title; //标题
                        this.loadpcp.innerHTML = data.price; //价格
                        this.bpic.src = data.url; //大放大镜下大图
                        let picarr = data.urls.split(','); //小放大镜左面的缩略图

                        let strhtml = '';
                        for (let value of picarr) {
                            strhtml += `<li style="float: left;"><img src="${value}" ></li>`;
                        }
                        this.list.innerHTML = strhtml;
                    }
                    //放大镜效果。
                scale() {
                    let _this = this;
                    //鼠标引入小图，显示小放和大放
                    this.spic.onmouseover = function() {
                        _this.sf.style.visibility = 'visible';
                        _this.bf.style.visibility = 'visible';
                        //获取小放的尺寸
                        //小放/大放=小图/大图
                        _this.sf.style.width = _this.spic.offsetWidth * _this.bf.offsetWidth / _this.bpic.offsetWidth + 'px';
                        _this.sf.style.height = _this.spic.offsetHeight * _this.bf.offsetHeight / _this.bpic.offsetHeight + 'px';
                        //求比例
                        _this.bili = _this.bf.offsetWidth / _this.sf.offsetWidth;
                        this.onmousemove = function(ev) {
                            var ev = ev || window.event;
                            _this.spicmove(ev);
                        }
                    };
                    this.spic.onmouseout = function() {
                        _this.sf.style.visibility = 'hidden';
                        _this.bf.style.visibility = 'hidden';
                    };
                    //     //点击小的缩略图，进行图片的切换
                    //     //事件委托
                    this.list.onclick = function(ev) {
                            var ev = ev || window.event;
                            let ele = ev.target || ev.srcElement;
                            if (ele.nodeName === 'IMG') {
                                let imgurl = ele.src; //获取图片地址
                                _this.spicimg.src = imgurl;
                                _this.bpic.src = imgurl;
                            }
                        }
                        //缩略图运动
                    let num = 5; //缩略图可视长度。5个li
                    this.right.onclick = function() {
                        let aLi = document.querySelectorAll('.pic-items ul li'); //8
                        let liwidth = aLi[0].offsetHeight; //一个li的width
                        if (aLi.length > num) {
                            num++;
                            if (num === aLi.length) {
                                _this.right.style.color = '#fff';
                            }
                            bufferMove(_this.list, {
                                top: -(num - 5) * liwidth
                            });
                        }
                    };

                    this.left.onclick = function() {
                        let aLi = document.querySelectorAll('.pic-items ul li'); //8
                        let liwidth = aLi[0].offsetHeight; //一个li的width
                        if (num > 5) {
                            num--;
                            if (num === 5) {
                                _this.left.style.color = '#fff';
                            }
                            bufferMove(_this.list, {
                                top: -(num - 5) * liwidth
                            });
                            _this.right.style.color = "#333";
                        }
                    };
                }
                spicmove(ev) {
                    let l = ev.clientX - this.goodsinfo.offsetLeft - this.sf.offsetWidth / 2;
                    let t = ev.clientY - this.goodsinfo.offsetTop - this.sf.offsetHeight / 2;

                    if (l <= 0) {
                        l = 0;
                    } else if (l >= this.spic.offsetWidth - this.sf.offsetWidth - 2) {
                        l = this.spic.offsetWidth - this.sf.offsetWidth - 2
                    }

                    if (t <= 0) {
                        t = 0;
                    } else if (t >= this.spic.offsetHeight - this.sf.offsetHeight - 2) {
                        t = this.spic.offsetHeight - this.sf.offsetHeight - 2
                    }

                    this.sf.style.left = l + 'px';
                    this.sf.style.top = t + 'px';
                    //给大图赋值。
                    this.bpic.style.left = -l * this.bili + 'px';
                    this.bpic.style.top = -t * this.bili + 'px';
                }

                // //购物车操作
                goodscart() {
                    let _this = this;
                    let sidarr = []; //商品的编号
                    let numarr = []; //商品的数量
                    //商品的编号：sidarr   [2,4,6,8]
                    //商品的数量：numarr   [13,35,78,90]
                    function cookietoarray() {
                        if (jstool.getcookie('cookiesid') && jstool.getcookie('cookienum')) {
                            sidarr = jstool.getcookie('cookiesid').split(',');
                            numarr = jstool.getcookie('cookienum').split(',');
                        }
                    }
                    //点击加入购物车按钮
                    this.btn.onclick = function() {
                        cookietoarray();
                        //判断是否是第一次点击
                        //获取当前点击的按钮所对应的图片上面的sid
                        if (sidarr.indexOf(_this.sid) !== -1) { //存在,改变数量
                            // console.log(sidarr);
                            // console.log(numarr);
                            // console.log(numarr[sidarr.indexOf(_this.sid)]);
                            let num = parseInt(numarr[sidarr.indexOf(_this.sid)]); //原来的数量
                            let result = parseInt(_this.count.value) + num; //当前的数量+原来的数量
                            numarr[sidarr.indexOf(_this.sid)] = result;
                            jstool.addcookie('cookienum', numarr.toString(), 10);

                        } else { //不存在
                            //将图片的编号push到sidarr
                            sidarr.push(_this.sid);
                            jstool.addcookie('cookiesid', sidarr.toString(), 10);
                            //将商品的第一次购买的数量存入numarr
                            numarr.push(_this.count.value);
                            jstool.addcookie('cookienum', numarr.toString(), 10);
                        }
                    }
                }
            }
            new Detail().init();
        }();
    </script></body></html>